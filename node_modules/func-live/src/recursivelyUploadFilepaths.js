import { uploadFile } from './uploadFile.js'
import fs from 'fs'

export const isObject = thing =>
  !(thing instanceof Array)
  && thing instanceof Object
  && typeof thing !== `function`
  && thing

export const recursivelyUploadFilepaths = async input => {
  if(typeof input === 'string') {
    if(fs.existsSync(input) && fs.statSync(input).isFile()) input = await uploadFile({ input })
    return input
  }
  if(isObject(input)){
    const output = {}
    await Promise.all(Object.keys(input).map(async key => {
      output[key] = await recursivelyUploadFilepaths(input[key])
    }))
    return output
  }
  if(Array.isArray(input))
    return await Promise.all(input.map(async item => {
      return recursivelyUploadFilepaths(item)
    }))
  return input
}

// recursivelyUploadFilepaths(example).then(console.log)
